<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#071014" />
  <meta name="description" content="Research homepage (PWA) for Tatemata Yuuji. Serial Experiments Lain-inspired interface." />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <title>Tatemata Yuuji — Research Layer</title>

  <!-- ✅ NOISE ADD-ON (inline) -->
  <style>
    /* overlay layers (do not block clicks) */
    .vignette, .chromab, .filmgrain, .filmdust{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9; /* below character z-index 10, above background */
    }

    /* vignette */
    .vignette{
      background: radial-gradient(circle at 50% 45%,
        rgba(0,0,0,0) 55%,
        rgba(0,0,0,.55) 100%);
      opacity:.85;
      mix-blend-mode: multiply;
    }

    /* subtle chromatic aberration pulse */
    .chromab{
      opacity:.22;
      filter: blur(.2px);
      mix-blend-mode: screen;
      background:
        radial-gradient(circle at 40% 50%, rgba(158,247,255,.08), transparent 55%),
        radial-gradient(circle at 60% 55%, rgba(255,122,217,.06), transparent 55%);
      animation: chromaShift 2.8s infinite steps(2);
    }
    @keyframes chromaShift{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(1px,0); }
      50%{ transform: translate(-1px,1px); }
      75%{ transform: translate(0,-1px); }
      100%{ transform: translate(0,0); }
    }

    /* film grain (CSS) */
    .filmgrain{
      opacity:.18;              /* ←ザラつき強め */
      mix-blend-mode: overlay;
      background-image:
        repeating-radial-gradient(circle at 20% 30%,
          rgba(255,255,255,.065) 0,
          rgba(255,255,255,.065) 1px,
          transparent 2px,
          transparent 3px);
      animation: grainJitter .55s steps(2,end) infinite;
    }
    @keyframes grainJitter{
      0%{ transform: translate(0,0); }
      20%{ transform: translate(-2px,1px); }
      40%{ transform: translate(1px,-1px); }
      60%{ transform: translate(-1px,-2px); }
      80%{ transform: translate(2px,1px); }
      100%{ transform: translate(0,0); }
    }

    /* dust specks */
    .filmdust{
      opacity:.12;              /* ←埃も少し強め */
      mix-blend-mode: screen;
      background-image:
        radial-gradient(circle at 12% 18%, rgba(255,255,255,.10) 0 1px, transparent 2px),
        radial-gradient(circle at 82% 38%, rgba(255,255,255,.08) 0 1px, transparent 2px),
        radial-gradient(circle at 32% 78%, rgba(255,255,255,.07) 0 1px, transparent 2px),
        radial-gradient(circle at 58% 62%, rgba(255,255,255,.06) 0 1px, transparent 2px),
        radial-gradient(circle at 71% 86%, rgba(255,255,255,.08) 0 1px, transparent 2px);
      animation: dustDrift 4.2s steps(2,end) infinite;
    }
    @keyframes dustDrift{
      0%{ transform: translate(0,0); opacity:.12; }
      25%{ transform: translate(1px,-1px); opacity:.10; }
      50%{ transform: translate(-1px,1px); opacity:.13; }
      75%{ transform: translate(1px,1px); opacity:.11; }
      100%{ transform: translate(0,0); opacity:.12; }
    }

    /* stronger scanlines (override) */
    .scanlines{ opacity: .62 !important; }

    /* micro flicker */
    body{ animation: flicker 6.5s infinite; }
    @keyframes flicker{
      0%,100%{ filter:none; }
      47%{ filter:none; }
      48%{ filter: contrast(1.08) saturate(1.05); }
      49%{ filter:none; }
      79%{ filter:none; }
      80%{ filter: contrast(1.12) saturate(1.08); }
      81%{ filter:none; }
    }

    /* ✅ Hidden link control (NO !important lock) */
    #hidden-link.is-hidden{ display:none; }
    #hidden-link.is-unlocked{ display:block; }

    /* ✅ spike (temporary) */
    .noise-spike #noise{ opacity:.34 !important; filter: contrast(1.25) saturate(.9); }
    .noise-spike .filmgrain{ opacity:.30 !important; }
    .noise-spike .filmdust{ opacity:.22 !important; }
  </style>
</head>

<body>
  <div class="bg" style="background-image:url('assets/img/bg-index.png')"></div>

  <!-- characters -->
  <img
    src="assets/img/char-01.png"
    alt="character"
    style="
      position: fixed;
      right: 0;
      bottom: 0;
      width: 320px;
      opacity: 0.25;
      z-index: 10;
    "
  />
  <img
    src="assets/img/char-01.png"
    alt="observer"
    style="
      position: fixed;
      right: -60px;
      bottom: -40px;
      width: 360px;
      opacity: 0.18;
      pointer-events: none;
      z-index: 2;
    "
  />

  <!-- overlays -->
  <div class="filmgrain"></div>
  <div class="filmdust"></div>
  <div class="chromab"></div>
  <div class="vignette"></div>

  <canvas id="noise"></canvas>
  <div class="scanlines"></div>

  <main class="shell">
    <section class="panel" role="region" aria-label="Tatemata Yuuji Research Layer">
      <header class="topbar">
        <div class="brand">
          <div class="title">SERIAL // ENTRY POINT</div>
          <div class="name" data-glitch="TATEMATA YUUJI">TATEMATA YUUJI</div>
        </div>
        <div class="pill" id="sysclock"></div>
      </header>

      <div class="content">
        <div class="small" style="margin-bottom:14px">
          Networked notes, epistemic maps, and a private layer.<br/>
          <span style="opacity:.75">Tip: Sometimes the system listens to shifting <b>layer</b>.</span>
        </div>

        <div class="grid">
          <a class="node" href="pages/research-map.html">
            <div class="glitch">01</div>
            <div class="kicker">LINK</div>
            <div class="label" data-glitch="RESEARCH MAP">RESEARCH MAP</div>
            <div class="desc">テーマ間の接続図。クリックで短いノートを読めます。</div>
          </a>

          <a class="node" href="pages/counseling.html">
            <div class="glitch">02</div>
            <div class="kicker">LOCKED</div>
            <div class="label" data-glitch="COUNSELING LOG">COUNSELING LOG</div>
            <div class="desc">鍵付きの記録。</div>
          </a>

          <a class="node" href="pages/bibliography.html">
            <div class="glitch">03</div>
            <div class="kicker">INDEX</div>
            <div class="label" data-glitch="BIBLIOGRAPHY">BIBLIOGRAPHY</div>
            <div class="desc">論文・資料リンク集。検索とタグ。</div>
          </a>

          <a class="node" href="pages/about.html">
            <div class="glitch">04</div>
            <div class="kicker">PROFILE</div>
            <div class="label" data-glitch="ABOUT / INTERESTS">ABOUT / INTERESTS</div>
            <div class="desc">来歴・趣味・関心領域。研究と制作の交点。</div>
          </a>
        </div>

        <div class="hr"></div>

        <!-- Hidden link: default hidden, unlocked by typing Observe -->
        <a id="hidden-link" class="node is-hidden" href="pages/hidden.html" aria-hidden="true">
          <div class="glitch">??</div>
          <div class="kicker">DEEP</div>
          <div class="label" data-glitch="HIDDEN LAYER">HIDDEN LAYER</div>
          <div class="desc">観測される前の記述。内的宇宙の仮ログ。</div>
        </a>

        <div class="small" style="margin-top:12px; opacity:.7">
INTELLECTUM VALDE AMA.
        </div>
      </div>

      <div class="footer">
        <div>© <span id="y"></span> Tatemata Yuuji</div>
        <div class="pill">STATUS: ONLINE</div>
      </div>
    </section>
  </main>

  <!-- your existing module (kept) -->
  <script type="module" src="assets/js/index.js"></script>

  <!-- FIXED inline script -->
  <script>
    // year + clock
    document.getElementById("y").textContent = new Date().getFullYear();
    const clock = document.getElementById("sysclock");
    setInterval(() => {
      clock.textContent = "SYS " + new Date().toISOString().replace("T"," ").slice(0,19) + "Z";
    }, 1000);

    // ===== Hidden Layer control =====
    const hiddenLink = document.getElementById("hidden-link");

    // always hidden on each load
    if (hiddenLink) {
      hiddenLink.classList.add("is-hidden");
      hiddenLink.classList.remove("is-unlocked");
      hiddenLink.setAttribute("aria-hidden", "true");
    }

    // noise spike
    function spikeNoise(ms=220){
      document.documentElement.classList.add("noise-spike");
      setTimeout(() => document.documentElement.classList.remove("noise-spike"), ms);
    }

    // unlock by typing Observe
    let buf = "";
    document.addEventListener("keydown", (e) => {
      if (e.key.length !== 1) return;
      buf = (buf + e.key).slice(-16);

      // subtle spike on keystrokes
      if (e.key.trim()) spikeNoise(90);

      if (buf.toLowerCase().endsWith("observe")) {
        if (!hiddenLink) return;
        hiddenLink.classList.remove("is-hidden");
        hiddenLink.classList.add("is-unlocked");
        hiddenLink.setAttribute("aria-hidden", "false");

        // short glitch pulse (your CSS already supports this)
        document.documentElement.classList.add("glitch-run");
        spikeNoise(420);
        setTimeout(() => document.documentElement.classList.remove("glitch-run"), 420);
      }
    });

    // click also spikes noise
    document.addEventListener("pointerdown", () => spikeNoise(180));
  </script>
</body>
</html>
